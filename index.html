<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>稻禾村：眠行疑案</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- 頁面 0: 玩家配對大廳 -->
    <div id="page-lobby" class="page active">
      <div class="lobby-container">
        <div class="lobby-header">
          <h1>線上配對｜稻禾村：眠行疑案</h1>
          <p class="page-subtitle">在進入劇情前，先配對 4 位玩家並分配角色</p>
        </div>
        <div class="lobby-content">
          <div class="lobby-card">
            <h2>加入玩家</h2>
            <div class="lobby-form">
              <input id="player-name-input" type="text" placeholder="玩家暱稱（必填）">
              <select id="player-role-select">
                <option value="qingteng">青藤</option>
                <option value="rin">早川凜</option>
                <option value="lin">林衡</option>
                <option value="chief">村長</option>
              </select>
              <button id="add-player-btn" class="btn primary">加入配對</button>
            </div>
            <p class="lobby-hint">每個角色只能有 1 名玩家，需滿 4 人才能開始</p>
          </div>
          <div class="lobby-card">
            <h2>配對名單</h2>
            <ul id="player-list" class="player-list"></ul>
            <div class="lobby-actions">
              <button id="fill-demo-btn" class="btn">填入示例玩家</button>
              <button id="start-session-btn" class="btn primary large" disabled>開始劇情線</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 頁面 1: 開場與背景故事 -->
    <div id="page-intro" class="page active">
      <div class="intro-hero">
        <div class="overlay"></div>
        <div class="intro-content">
          <h1>稻禾村：眠行疑案</h1>
          <p class="subtitle">一個關於信仰、真相與選擇的故事</p>
        </div>
      </div>
      <div class="intro-body">
        <div class="card">
          <h2>歡迎來到稻禾村</h2>
          <p>這是一個被群山包圍的孤島，也是稻禾神眷顧的土地。在這裡，夢境與現實的界線並不明顯。早川家族的人說，當你在夜裡起身行走，那不是病，那是神的召喚。</p>
          <p>你們之中，有人被神選中，在夜裡漫步於神社的參道；有人被神遺棄，只能在清醒中嫉妒著那些夢遊的人。</p>
        </div>
        <div class="card">
          <h2>神隱事件</h2>
          <p>最近，村子裡發生了連續的「神隱」事件——或者用外人的說法，「意外墜落死亡」。</p>
          <p>昨晚，早川家的長子、下一任家主的繼承人——<strong>早川健</strong>，被發現死在神社的長階梯下。他的身邊，依然擺放著那神秘的稻穗圖案。</p>
        </div>
        <div class="card highlight-card">
          <h2>真相的抉擇</h2>
          <p>是神的召喚太過沈重？還是有人在黑暗中推了一把？</p>
          <p>今天，是早川健的葬禮，也是真相最後一次浮出水面的機會。</p>
        </div>
        <button id="enter-story-btn" class="btn primary large">進入故事</button>
      </div>
    </div>

    <!-- 頁面 2: 角色概覽（已配對） -->
    <div id="page-roles" class="page">
      <div class="layout">
        <div class="main-column">
          <div class="page-header">
            <h1>角色分配完成</h1>
            <p class="page-subtitle">點擊角色查看其私有劇本，再依序進入公開線索 → 私有線索 → 投票</p>
          </div>
          <div class="role-selection">
            <div id="role-grid" class="role-grid"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁面 3: 第一幕 - 葬禮上的暗流 -->
    <div id="page-act1" class="page">
      <div class="layout">
        <div class="main-column">
          <div class="story-container">
            <div class="story-header">
              <div class="act-info">
                <span class="act-number">第一幕</span>
                <h1 class="act-title">葬禮上的暗流</h1>
                <p class="act-subtitle">私人劇本閱讀（依玩家角色）</p>
              </div>
              <div class="role-switch">
                <label for="viewer-role-select">切換視角：</label>
                <select id="viewer-role-select"></select>
              </div>
            </div>
            <div class="script-card">
              <div class="script-header">
                <div class="role-info">
                  <span class="role-tag" id="script-role-tag"></span>
                  <h2 id="script-role-name"></h2>
                  <div class="role-player" id="script-player-name"></div>
                </div>
              </div>
              <div class="script-content">
                <div class="script-text" id="script-text"></div>
                <div class="script-task">
                  <div class="task-icon">📋</div>
                  <div class="task-content">
                    <h3>你的任務</h3>
                    <p id="script-task-text"></p>
                  </div>
                </div>
              </div>
              <div class="script-footer">
                <button id="to-public-btn" class="btn primary">進入公開線索</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁面 4: 搜證階段 -->
    <div id="page-investigation" class="page">
      <div class="layout">
        <div class="main-column">
          <div class="investigation-container">
            <div class="act-header">
              <span class="act-number">第二幕</span>
              <h1 class="act-title">搜證與公聊</h1>
              <p class="act-subtitle">線索卡設置（先公開，再個別）</p>
            </div>
            <div class="clue-section">
              <h2 class="section-title">第一輪搜證（公開線索）</h2>
              <div id="public-clues" class="clue-grid"></div>
            </div>
            <div class="clue-section">
              <h2 class="section-title">第二輪搜證（個別線索）</h2>
              <div id="hidden-clues" class="clue-grid"></div>
              <p class="muted-note">僅顯示目前視角角色可見的線索</p>
            </div>
            <div class="investigation-footer">
              <button id="to-private-btn" class="btn primary">顯示個別線索</button>
              <button id="to-debate-btn" class="btn primary large">進入投票階段</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁面 5: 推理與辯論 -->
    <div id="page-debate" class="page">
      <div class="layout">
        <div class="main-column">
          <div class="debate-container">
            <div class="act-header">
              <span class="act-number">第三幕</span>
              <h1 class="act-title">推理與辯論</h1>
              <p class="act-subtitle">核心衝突與線上投票</p>
            </div>
            <div class="debate-content">
              <div class="debate-points" id="debate-points"></div>
            </div>
            <div class="vote-section" id="vote-section">
              <h2>第四部分：兇手指認</h2>
              <p class="muted-note">每個角色需投出心中的兇手，提交後可查看統計</p>
              <div id="vote-form"></div>
              <div class="vote-results" id="vote-results"></div>
              <button id="submit-vote-btn" class="btn primary">提交投票</button>
              <button id="host-talk-btn" class="btn">主持人發言（機器人）</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁面 6: 投票與結局 -->
    <div id="page-ending" class="page">
      <div class="layout">
        <div class="main-column">
          <div class="ending-container">
            <div class="ending-header">
              <h1>第五部分：結局揭示</h1>
            </div>
            <div class="ending-content" id="ending-content"></div>
            <div class="ending-footer">
              <button id="reveal-truth-btn" class="btn primary">公布真相</button>
              <button id="restart-btn" class="btn primary large">重新開始</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 右側即時討論區 -->
  <div id="chat-wrapper" class="chat-wrapper">
    <div class="chat-header">
      <div>
        <div class="chat-title">即時討論區</div>
        <div class="chat-subtitle">文字 + 語音輸入</div>
      </div>
      <div class="chat-status" id="chat-status">未連線（本地模擬）</div>
    </div>
    <div id="chat-messages" class="chat-messages"></div>
    <div class="chat-input">
      <textarea id="chat-input" rows="2" placeholder="輸入訊息，按 Enter 送出"></textarea>
      <div class="chat-actions">
        <button id="voice-btn" class="btn">🎤 語音</button>
        <button id="send-chat-btn" class="btn primary">送出</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
